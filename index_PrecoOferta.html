<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Etiquetas de Oferta Dupla - Responsivo</title>
    
    <style>
        /* ==================== IMPORT DE FONTES ==================== */
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;700;900&display=swap');
        
        /* ==================== VARIÁVEIS CSS (Melhor organização) ==================== */
        :root {
            --cor-primaria: #3f7bbf;
            --cor-sucesso: #4CAF50;
            --cor-alerta: #ff0000;
            --cor-fundo: #f4f4f4;
            --cor-texto: #333;
        }

        /* ==================== ESTILOS GERAIS E FORMULÁRIO (MOBILE-FIRST) ==================== */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--cor-fundo);
            padding: 15px; /* Reduzido para mobile */
            margin: 0;
        }

        .container-principal {
            display: flex;
            flex-direction: column; /* Padrão: empilhado (mobile) */
            gap: 20px;
        }

        .formulario, .container-etiquetas-impressao {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%; /* Ocupa a largura total no mobile */
            position: relative; /* Remove o sticky no mobile */
            top: auto;
        }

        .formulario label {
            display: block;
            margin-top: 10px;
            font-weight: 600;
            font-size: 0.95em; /* Fonte um pouco menor */
        }
        
        /* Estilo para select e inputs (Ajustado para mobile) */
        .formulario select,
        .formulario input[type="text"], 
        .formulario input[type="number"] {
            width: 100%;
            padding: 10px; /* Aumentado para melhor toque */
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        /* Estilo para campos desabilitados */
        .formulario input[disabled] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

        .botoes-acao {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .botoes-acao button {
            flex-grow: 1;
            padding: 12px 15px; /* Maior área de toque */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
        }
        #btnAddEtiqueta { background-color: var(--cor-sucesso); color: white; }
        #btnPrint, #btnLimpar { background-color: var(--cor-primaria); color: white; }

        .container-etiquetas-impressao {
            min-height: 200px; /* Menor altura mínima para mobile */
        }

        #etiquetas-output {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center; /* Centraliza no mobile */
        }
        
        /* Área de pré-visualização (opcional: centralizar ou usar scroll horizontal) */
        #preview-etiqueta-wrapper {
             overflow-x: auto; 
             margin-top: 20px;
             text-align: center; /* Centraliza a etiqueta se ela couber */
             padding: 5px 0;
        }

        /* ==================== DESKTOP/TABLET VIEW (>= 768px) ==================== */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            .container-principal {
                flex-direction: row; /* Layout de duas colunas */
                align-items: flex-start;
            }
            .formulario {
                width: 300px;
                position: sticky; /* Retorna o sticky no desktop */
                top: 20px;
            }
            .container-etiquetas-impressao {
                min-height: 400px;
            }
            #etiquetas-output {
                justify-content: flex-start; /* Alinha à esquerda no desktop */
            }
            #preview-etiqueta-wrapper {
                 overflow-x: visible; 
                 text-align: left;
            }
        }

        /* ==================== ESTILOS BASE DA ETIQUETA (COM ESCALA) ==================== */
        .etiqueta {
            /* Variáveis CSS padrão - Serão definidas pelo JS */
            --etiqueta-largura: 74mm; 
            --etiqueta-altura: 105mm;
            --escala-fator-display: 1; /* Escala para caber na tela */
            --conteudo-fator: 1; /* Escala para o texto e espaçamento */

            width: var(--etiqueta-largura); 
            height: var(--etiqueta-altura); 
            
            border: 1px solid #ccc; 
            padding: calc(3mm * var(--conteudo-fator)); 
            box-sizing: border-box; 
            page-break-inside: avoid; 
            background-color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center; 
            justify-content: space-between; 
            position: relative; 
            overflow: hidden;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1); 
            
            /* Escala apenas para a visualização na tela */
            transform: scale(var(--escala-fator-display, 1)); 
            transform-origin: top left; 
            margin: 0; 
        }
        
        /* Ajuste de margem para as etiquetas na lista, compensando a escala de visualização */
        #etiquetas-output .etiqueta {
            /* Fórmula para compensar a margem causada pela redução do zoom (transform: scale) */
            margin-bottom: calc(var(--etiqueta-altura) * (var(--escala-fator-display, 1) - 1) * -1 + 10px);
            margin-right: calc(var(--etiqueta-largura) * (var(--escala-fator-display, 1) - 1) * -1 + 10px);
        }

        /* Conteúdo e Tipografia */
        .oferta-tag { 
            font-family: 'Bebas Neue', sans-serif; 
            font-size: calc(24pt * var(--conteudo-fator)); 
            color: var(--cor-alerta); font-weight: 900; text-transform: uppercase; 
            margin-bottom: calc(5pt * var(--conteudo-fator)); 
        }
        .info-produto-container { width: 100%; text-align: center; }
        
        .nome-produto, .descricao-produto, .marca-produto { 
            line-height: 1.1; text-transform: uppercase; 
            margin-bottom: calc(3pt * var(--conteudo-fator)); 
            word-wrap: break-word; overflow-wrap: break-word; 
        }
        
        .nome-produto { 
            font-size: calc(16pt * var(--conteudo-fator)); 
            font-weight: 600; color: #000; white-space: normal; 
            position: static; 
        } 
        
        .descricao-produto { font-size: calc(10pt * var(--conteudo-fator)); font-weight: 600; color: var(--cor-texto); }
        .marca-produto { font-size: calc(10pt * var(--conteudo-fator)); font-weight: 600; color: var(--cor-alerta); }
        
        .peso-produto { 
            position: absolute; 
            top: calc(10mm * var(--conteudo-fator)); 
            right: calc(5mm * var(--conteudo-fator)); 
            font-size: calc(8pt * var(--conteudo-fator)); 
            font-weight: 700; color: var(--cor-texto); transform: rotate(-10deg); 
        }
        .logo-empresa { 
            width: calc(60pt * var(--conteudo-fator)); 
            margin-top: auto; 
            padding-top: calc(5pt * var(--conteudo-fator)); 
        }

        /* ==================== ESTILOS DE OFERTA DUPLA (ALINHAMENTO QUANTIDADE/VALOR) ==================== */

        .ofertas-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: calc(1pt * var(--conteudo-fator));
            margin-top: calc(10pt * var(--conteudo-fator));
        }
        
        .oferta-bloco {
            display: flex;
            align-items: center; 
            justify-content: center;
            width: 100%;
            margin-top: 0;
        }

        .oferta-quantidade-x {
            font-family: 'Bebas Neue', sans-serif;
            font-size: calc(60pt * var(--conteudo-fator)); 
            color: var(--cor-alerta);
            line-height: 0.95; 
            padding-right: calc(15pt * var(--conteudo-fator));
            position: relative;
            top: calc(5pt * var(--conteudo-fator));
            font-weight: 900;
        }

        .texto-e {
            font-size: calc(14pt * var(--conteudo-fator)); 
            color: var(--cor-texto);
            font-weight: 700;
            margin-right: calc(8pt * var(--conteudo-fator));
            position: relative;
            top: calc(5pt * var(--conteudo-fator));
        }

        .valor-principal-container {
            display: flex;
            align-items: flex-start;
            position: relative;
            top: calc(5pt * var(--conteudo-fator));
            color: var(--cor-alerta);
            font-weight: 900;
        }
        
        /* Alinhamento dos blocos de valor com o bloco "É" */
        .ofertas-container > .oferta-bloco:first-of-type .valor-principal-container {
            /* Espaço para afastar do 'É' de cima, mantendo o alinhamento */
            margin-left: calc(12pt * var(--conteudo-fator)); 
        }
        
        .ofertas-container > .oferta-bloco:last-of-type .valor-principal-container {
            /* Espaço para afastar do divisor 'OU' de baixo */
            margin-left: calc(4pt * var(--conteudo-fator)); 
        }

        .valor-principal {
            font-size: calc(60pt * var(--conteudo-fator)); 
            line-height: 0.95;
            letter-spacing: calc(1pt * var(--conteudo-fator)); 
            font-family: 'Bebas Neue', sans-serif;
            display: flex;
            align-items: flex-start;
            position: relative;
            top: 0; 
        }

        .valor-principal .centavos {
            font-size: calc(30pt * var(--conteudo-fator)); 
            font-weight: 700;
            margin-left: 0pt;
            font-family: 'Bebas Neue', sans-serif;
            position: relative;
            top: calc(6pt * var(--conteudo-fator));
        }
        
        .divisor-ou {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-start; 
            gap: calc(5px * var(--conteudo-fator));
            /* Recua para alinhar com o número */
            margin: 0 0 0 calc(5pt * var(--conteudo-fator)); 
        }
        
        .divisor-linha {
            width: calc(60pt * var(--conteudo-fator)); 
            flex-grow: 0; 
            height: calc(1px * var(--conteudo-fator));
            background-color: var(--cor-alerta);
            margin: 0; 
        }
        .divisor-ou span {
            font-family: 'Bebas Neue', sans-serif;
            font-size: calc(16pt * var(--conteudo-fator));
            font-weight: 900;
            color: var(--cor-alerta);
            padding: 0 calc(5px * var(--conteudo-fator));
        }

        /* ==================== ESTILOS DE IMPRESSÃO (TAMANHO REAL) ==================== */
        @media print {
            .formulario, .botoes-acao, h2, h3, hr {
                display: none;
            }

            body {
                margin: 0;
                padding: 0;
                background-color: white;
            }

            .container-etiquetas-impressao {
                box-shadow: none;
                padding: 0;
                margin: 0;
                width: 100%;
                min-height: auto;
            }
            
            .etiqueta {
                /* Força o uso das dimensões reais em MM e anula qualquer escala de visualização */
                width: var(--etiqueta-largura) !important; 
                height: var(--etiqueta-altura) !important;
                
                /* Anula a margem de compensação de display */
                margin: 0 !important; 
                
                border: 1px dashed #ccc; 
                float: left; 
                box-shadow: none; 
                transform: none !important; 
                
                /* Garante que o conteúdo seja renderizado com a escala 1.0 para o tamanho real */
                --conteudo-fator: 1.0 !important; 
                --escala-fator-display: 1.0 !important;
                
                /* Adiciona uma pequena margem para garantir que não haja cortes entre as etiquetas */
                margin-right: 1mm !important;
                margin-bottom: 1mm !important;
            }
        }
    </style>
</head>
<body>

    <div class="container-principal">
        <div class="formulario">
            <h2>Adicionar Oferta Dupla</h2>
            <form id="formEtiqueta" oninput="updateAllEtiquetas()">
                
                <h4 style="margin-top: 15px;">DIMENSÕES (mm)</h4>
                <label for="tipoDimensao">Escolha o Padrão:</label>
                <select id="tipoDimensao" onchange="handleDimensionChange()">
                    <option value="A7" selected>A7 (74mm x 105mm)</option>
                    <option value="A6">A6 (105mm x 148mm)</option>
                    <option value="A5">A5 (148mm x 210mm)</option>
                    <option value="A4">A4 (210mm x 297mm)</option>
                    <option value="CUSTOM">Personalizado</option>
                </select>
                
                <label for="larguraEtiqueta">Largura da Etiqueta (mm):</label>
                <input type="number" id="larguraEtiqueta" value="74" step="1">
                
                <label for="alturaEtiqueta">Altura da Etiqueta (mm):</label>
                <input type="number" id="alturaEtiqueta" value="105" step="1">
                
                <hr style="margin-top: 20px;">
                
                <label for="produto">Produto:</label>
                <input type="text" id="produto" placeholder="Ex: Pão de Forma" required>
                
                <label for="descricao">Descrição:</label>
                <input type="text" id="descricao" placeholder="Ex: Tradicional">
                
                <label for="marca">Marca:</label>
                <input type="text" id="marca" placeholder="Ex: Pullman">

                <h4 style="margin-top: 15px;">OPÇÃO 1 (Principal)</h4>
                <label for="quantidadeX1">Quantidade (X1):</label>
                <input type="number" id="quantidadeX1" step="1" value="1" required>

                <label for="precoTotalY1">Preço Total (Y1):</label>
                <input type="number" id="precoTotalY1" step="0.01" placeholder="Ex: 4.00" required>
                
                <h4 style="margin-top: 15px;">OPÇÃO 2 (Adicional)</h4>
                <label for="quantidadeX2">Quantidade (X2):</label>
                <input type="number" id="quantidadeX2" step="1" value="3" required>

                <label for="precoTotalY2">Preço Total (Y2):</label>
                <input type="number" id="precoTotalY2" step="0.01" placeholder="Ex: 10.00" required>

                <label for="peso">Peso/Volume (Opcional):</label>
                <input type="text" id="peso" placeholder="Ex: 450g ou 1 Litro">
            </form>

            <div class="botoes-acao">
                <button id="btnAddEtiqueta" onclick="adicionarEtiqueta()">Adicionar Etiqueta</button>
            </div>
            
            <h3 style="margin-top: 30px;">Pré-visualização da Etiqueta:</h3>
            <div id="preview-etiqueta-wrapper">
                <div id="preview-etiqueta" class="etiqueta" style="border: 2px solid #ff9800; box-shadow: 0 0 15px rgba(255, 152, 0, 0.5);">
                    <p style="text-align: center; font-style: italic; color: #555; padding: 10px;">Preencha os dados e clique em Adicionar.</p>
                </div>
            </div>
        </div>

        <div class="container-etiquetas-impressao">
            <h3>Lista de Etiquetas para Impressão:</h3>
            <div class="botoes-acao">
                <button id="btnPrint" onclick="window.print()">Imprimir Etiquetas</button>
                <button id="btnLimpar" onclick="limparEtiquetas()">Limpar Lista</button>
            </div>
            <hr style="margin-top: 10px; border: 0; border-top: 1px solid #eee;">
            <div id="etiquetas-output">
                <p>Use o formulário para gerar ofertas Duplas.</p>
            </div>
        </div>
    </div>

    <script>
        /* ==================== LÓGICA JAVASCRIPT ==================== */
        
        const BASE_WIDTH_MM = 74; // Largura base (A7)
        const MM_TO_PX = 3.77953; // Fator de conversão (milímetros para pixels em 96 DPI)

        // Dimensões A-Series em mm (Largura x Altura)
        const DIMS = {
            A7: { largura: 74, altura: 105 },
            A6: { largura: 105, altura: 148 },
            A5: { largura: 148, altura: 210 },
            A4: { largura: 210, altura: 297 },
            CUSTOM: null
        };
        
        /**
         * Altera os campos de dimensão (Largura e Altura) conforme a seleção do usuário.
         */
        function handleDimensionChange() {
            const select = document.getElementById('tipoDimensao');
            const larguraInput = document.getElementById('larguraEtiqueta');
            const alturaInput = document.getElementById('alturaEtiqueta');
            const tipo = select.value;

            if (tipo === 'CUSTOM') {
                larguraInput.disabled = false;
                alturaInput.disabled = false;
            } else {
                const dimensoes = DIMS[tipo];
                larguraInput.value = dimensoes.largura;
                alturaInput.value = dimensoes.altura;
                
                larguraInput.disabled = true;
                alturaInput.disabled = true;
            }

            // Força a atualização de todas as etiquetas com as novas dimensões
            updateAllEtiquetas();
            updatePreview(); // Chamada adicional para garantir a atualização da preview
        }

        /**
         * Retorna as dimensões atuais e os fatores de escala para display e conteúdo.
         */
        function obterDimensoesEEScala() {
            const larguraMM = parseFloat(document.getElementById('larguraEtiqueta').value) || DIMS.A7.largura;
            const alturaMM = parseFloat(document.getElementById('alturaEtiqueta').value) || DIMS.A7.altura;

            // Fator de escala do CONTEÚDO (para ajustar fontes, padding, etc)
            const fatorConteudo = larguraMM / BASE_WIDTH_MM;
            
            // Fator de escala de VISUALIZAÇÃO (para caber no container - max 280px de largura)
            // Usamos uma largura máxima de 280px para o display, para caber bem no container mobile/desktop.
            const fatorDisplay = Math.min(1, 280 / (larguraMM * MM_TO_PX)); 

            return { larguraMM, alturaMM, fatorDisplay, fatorConteudo };
        }
        
        /**
         * Aplica as dimensões reais e os fatores de escala às variáveis CSS da etiqueta.
         */
        function aplicarDimensoesEEScala(etiquetaElement, larguraMM, alturaMM, fatorDisplay, fatorConteudo) {
            etiquetaElement.style.setProperty('--etiqueta-largura', `${larguraMM}mm`);
            etiquetaElement.style.setProperty('--etiqueta-altura', `${alturaMM}mm`);
            
            etiquetaElement.style.setProperty('--escala-fator-display', fatorDisplay);
            etiquetaElement.style.setProperty('--conteudo-fator', fatorConteudo);
        }

        /**
         * Ajusta o tamanho da fonte do nome do produto (Nome, Descrição, Marca).
         */
        function ajustarFonteProduto(etiquetaElement, larguraMM, fatorConteudo) {
            // A lógica de ajuste de fonte dinâmica foi simplificada e mantida via variáveis CSS (calc)
            // Mas se a necessidade for reajustar o tamanho da fonte base aqui, esta função seria o local.
            // Por enquanto, o foco é apenas aplicar a escala de conteúdo CSS.
        }

        /**
         * Gera o SVG da logo (Grupo Mega).
         */
        function gerarLogoSvg() {
             return `
                 <svg viewBox="0 0 100 20">
                     <rect x="0" y="0" width="100" height="20" rx="10" fill="#66b3ff" />
                     <rect x="0" y="0" width="100" height="20" rx="10" fill="url(#grad)" />
                     <defs>
                         <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                             <stop offset="0%" style="stop-color:#3f7bbf;stop-opacity:1" />
                             <stop offset="100%" style="stop-color:#66b3ff;stop-opacity:1" />
                         </linearGradient>
                     </defs>
                     <circle cx="20" cy="10" r="7" fill="white" />
                     <text x="20" y="13" font-family="Poppins, sans-serif" font-size="8" text-anchor="middle" fill="#E60000" font-weight="900">G</text>
                     <text x="50" y="13" font-family="Poppins, sans-serif" font-size="8" text-anchor="middle" fill="white" font-weight="700">GRUPO</text>
                     <text x="80" y="13" font-family="Poppins, sans-serif" font-size="8" text-anchor="middle" fill="white" font-weight="700">MEGA</text>
                 </svg>
             `;
        }
        
        /**
         * Formata o preço float para Reais e Centavos (strings).
         */
        function formatarPreco(precoTotal) {
             if (isNaN(precoTotal)) { return { reais: '0', centavos: '00' }; }
             const precoFormatado = precoTotal.toFixed(2).replace('.', ',');
             const partesPreco = precoFormatado.split(',');
             return {
                 reais: partesPreco[0],
                 centavos: partesPreco[1]
             };
        }

        /**
         * Gera o HTML do bloco de preço (ex: 1 É 4,00).
         */
        function gerarHtmlPreco(quantidade, precoTotal) {
            const { reais, centavos } = formatarPreco(precoTotal);
            const valorPrincipalHtml = `<div class="valor-principal">${reais}<span class="centavos">,${centavos}</span></div>`;

            return `
                <div class="oferta-bloco">
                    <div class="oferta-quantidade-x">${quantidade}</div>
                    <div class="texto-e">É</div>
                    <div class="valor-principal-container">${valorPrincipalHtml}</div>
                </div>
            `;
        }

        /**
         * Gera o HTML completo de uma etiqueta.
         */
        function gerarEtiquetaCompleta(larguraMM, alturaMM, fatorDisplay, fatorConteudo) {
            const nomeProduto = document.getElementById('produto').value.trim();
            const descricao = document.getElementById('descricao').value.trim();
            const marca = document.getElementById('marca').value.trim();
            
            const quantidadeX1 = parseInt(document.getElementById('quantidadeX1').value);
            const precoTotalY1 = parseFloat(document.getElementById('precoTotalY1').value);
            
            const quantidadeX2 = parseInt(document.getElementById('quantidadeX2').value);
            const precoTotalY2 = parseFloat(document.getElementById('precoTotalY2').value);
            
            const peso = document.getElementById('peso').value.trim();
            
            if (!nomeProduto || isNaN(quantidadeX1) || quantidadeX1 <= 0 || isNaN(precoTotalY1) || precoTotalY1 <= 0 ||
                isNaN(quantidadeX2) || quantidadeX2 <= 0 || isNaN(precoTotalY2) || precoTotalY2 <= 0) {
                 return null;
            }

            const oferta1Html = gerarHtmlPreco(quantidadeX1, precoTotalY1);
            const oferta2Html = gerarHtmlPreco(quantidadeX2, precoTotalY2);

            let infoProdutoHtml = '';
            if (nomeProduto) infoProdutoHtml += `<div class="nome-produto">${nomeProduto.toUpperCase()}</div>`;
            if (descricao) infoProdutoHtml += `<div class="descricao-produto">${descricao.toUpperCase()}</div>`;
            if (marca) infoProdutoHtml += `<div class="marca-produto">${marca.toUpperCase()}</div>`;
            
            const logoSvg = gerarLogoSvg();
            const pesoHtml = peso ? `<div class="peso-produto">${peso}</div>` : '';

            const styleAttrs = `
                --etiqueta-largura: ${larguraMM}mm;
                --etiqueta-altura: ${alturaMM}mm;
                --escala-fator-display: ${fatorDisplay};
                --conteudo-fator: ${fatorConteudo};
            `;

            return `
                <div class="etiqueta" style="${styleAttrs}">
                    <div class="oferta-tag">OFERTA</div>
                    ${pesoHtml}
                    <div class="info-produto-container">
                        ${infoProdutoHtml}
                    </div>
                    
                    <div class="ofertas-container">
                        ${oferta1Html}
                        
                        <div class="divisor-ou">
                            <div class="divisor-linha"></div>
                            <span>OU</span>
                            <div class="divisor-linha"></div>
                        </div>
                        
                        ${oferta2Html}
                    </div>
                    
                    <div class="logo-empresa">${logoSvg}</div>
                </div>
            `;
        }

        /**
         * Atualiza a pré-visualização.
         */
        function updatePreview() {
            const { larguraMM, alturaMM, fatorDisplay, fatorConteudo } = obterDimensoesEEScala();
            const previewDiv = document.getElementById('preview-etiqueta');
            
            // Aplica as dimensões na div de preview para que ela não mude de tamanho
            previewDiv.style.setProperty('--etiqueta-largura', `${larguraMM}mm`);
            previewDiv.style.setProperty('--etiqueta-altura', `${alturaMM}mm`);
            previewDiv.style.setProperty('--escala-fator-display', fatorDisplay);
            previewDiv.style.setProperty('--conteudo-fator', fatorConteudo);

            const etiquetaHtml = gerarEtiquetaCompleta(larguraMM, alturaMM, fatorDisplay, fatorConteudo);
            
            if (etiquetaHtml) {
                 // Usa DOMParser para extrair o HTML interno (sem a div principal que tem a borda de preview)
                 const parser = new DOMParser();
                 const doc = parser.parseFromString(etiquetaHtml, 'text/html');
                 const etiquetaContent = doc.querySelector('.etiqueta').innerHTML;
                 previewDiv.innerHTML = etiquetaContent;
            } else {
                 previewDiv.innerHTML = '<p style="text-align: center; font-style: italic; color: #555; padding: 10px;">Preencha os dados e clique em Adicionar.</p>';
            }
        }

        /**
         * Percorre e atualiza as dimensões de TODAS as etiquetas já geradas (na lista e na preview).
         */
        function updateAllEtiquetas() {
            const { larguraMM, alturaMM, fatorDisplay, fatorConteudo } = obterDimensoesEEScala();
            
            // 1. Atualiza todas as etiquetas na lista
            document.querySelectorAll('#etiquetas-output .etiqueta').forEach(el => {
                aplicarDimensoesEEScala(el, larguraMM, alturaMM, fatorDisplay, fatorConteudo);
                ajustarFonteProduto(el, larguraMM, fatorConteudo); 
            });
            
            // 2. Atualiza a preview
            updatePreview();
        }

        /**
         * Cria uma nova etiqueta com os dados do formulário e adiciona à lista.
         */
        function adicionarEtiqueta() {
            const { larguraMM, alturaMM, fatorDisplay, fatorConteudo } = obterDimensoesEEScala();
            const novaEtiquetaHtml = gerarEtiquetaCompleta(larguraMM, alturaMM, fatorDisplay, fatorConteudo);
            
            if (!novaEtiquetaHtml) {
                alert("Por favor, preencha todos os campos obrigatórios da oferta dupla corretamente.");
                return;
            }
            
            const outputDiv = document.getElementById('etiquetas-output');

            // Remove a mensagem inicial se existir
            if (outputDiv.querySelector('p')) {
                outputDiv.innerHTML = ''; 
            }
            
            // Adiciona o HTML da nova etiqueta
            const newEtiquetaContainer = document.createElement('div');
            newEtiquetaContainer.innerHTML = novaEtiquetaHtml.trim();
            const etiquetaElement = newEtiquetaContainer.firstChild;
            outputDiv.appendChild(etiquetaElement);

            // Aplica as dimensões e escala *novamente* para o caso de ter sido colado como texto.
            aplicarDimensoesEEScala(etiquetaElement, larguraMM, alturaMM, fatorDisplay, fatorConteudo);
            ajustarFonteProduto(etiquetaElement, larguraMM, fatorConteudo);
            
            // Limpa o formulário de produto/preço
            document.getElementById('produto').value = '';
            document.getElementById('descricao').value = '';
            document.getElementById('marca').value = '';
            document.getElementById('precoTotalY1').value = '';
            document.getElementById('precoTotalY2').value = '';
            document.getElementById('peso').value = '';
            
            document.getElementById('produto').focus(); 
            
            // Garante que a preview seja atualizada com o formulário vazio
            updatePreview();
        }
        
        function limparEtiquetas() {
            if (confirm("Tem certeza que deseja limpar a lista de etiquetas?")) {
                document.getElementById('etiquetas-output').innerHTML = '<p>Use o formulário para gerar ofertas Duplas.</p>';
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
             // 1. Configura as dimensões iniciais (A7) e desabilita os campos
             handleDimensionChange(); // Simula a seleção inicial do A7
             
             // 2. Adiciona listeners para inputs de texto/número que afetam a preview
             document.getElementById('formEtiqueta').addEventListener('input', updatePreview);
             
             // 3. Adiciona listeners para os inputs de dimensão (caso o CUSTOM seja selecionado depois)
             document.getElementById('larguraEtiqueta').addEventListener('input', updateAllEtiquetas);
             document.getElementById('alturaEtiqueta').addEventListener('input', updateAllEtiquetas);
             
             // 4. Inicia a pré-visualização (A função handleDimensionChange já chama updatePreview)
        });
    </script>
</body>
</html>
