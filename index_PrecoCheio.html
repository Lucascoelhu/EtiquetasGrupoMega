<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Etiquetas de Oferta Aprimorado - Escala de Fonte</title>
    <style>
      /* ==================== IMPORT DE FONTES ==================== */
      @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;700;900&display=swap');

      /* ==================== ESTILOS GERAIS E FORMULÁRIO ==================== */
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #f4f4f4;
        padding: 20px;
      }

      .container-principal {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .formulario {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        width: 300px;
        height: fit-content;
        position: sticky;
        top: 20px;
      }

      .formulario label {
        display: block;
        margin-top: 10px;
        font-weight: 600;
      }

      .formulario input[type="text"],
      .formulario input[type="number"],
      .formulario select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-top: 5px;
      }

      .botoes-acao {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .botoes-acao button {
        flex-grow: 1;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
      }

      #btnAddEtiqueta {
        background-color: #4CAF50;
        color: white;
      }

      #btnPrint,
      #btnLimpar {
        background-color: #3f7bbf;
        color: white;
      }

      /* Área de visualização das etiquetas */
      .container-etiquetas-impressao {
        flex-grow: 1;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        min-height: 400px;
      }

      #etiquetas-output {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 20px;
      }

      /* ==================== ESTILO DA ETIQUETA DE OFERTA ==================== */
      
      .etiqueta {
        --fator-escala: 1; 
        border: 1px solid #ccc;
        display: inline-block;
        box-sizing: border-box;
        page-break-inside: avoid;
        background-color: #fff;
        display: flex; 
        flex-direction: column;
        position: relative;
        overflow: hidden;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        transition: width 0.3s ease, height 0.3s ease; 
      }
      
      /* CONTAINER INTERNO: Ocupa o espaço necessário, sem crescer */
      .etiqueta-conteudo {
          width: 100%;
          box-sizing: border-box; 
          padding: 10mm; 
          display: flex; 
          flex-direction: column;
          align-items: center;
          justify-content: flex-start; 
          position: relative;
          margin-bottom: 8pt; 
      }

      #preview-etiqueta {
        border: 2px solid #ff9800;
        box-shadow: 0 0 15px rgba(255, 152, 0, 0.5);
        margin-bottom: 20px;
      }

      /* Estilos Internos - USANDO CALC() E VAR(--FATOR-ESCALA) */
      .oferta-tag {
        font-size: calc(38pt * var(--fator-escala)); 
        color: #ff0000;
        font-weight: 900;
        text-transform: uppercase;
        margin-bottom: calc(5pt * var(--fator-escala));
      }

      .info-produto-container {
        width: 100%;
        text-align: center;
        margin-bottom: calc(4pt * var(--fator-escala));
        color: #ff0000;
      }

      .nome-produto {
        font-size: calc(20pt * var(--fator-escala)); 
        font-weight: 600;
        text-transform: uppercase;
        line-height: 1.1;
        color: #000;
        margin-top: calc(15pt * var(--fator-escala));
      }

      .marca-produto {
          font-size: calc(16pt * var(--fator-escala)); 
          font-weight: 600;
          line-height: 1.2;
          text-transform: uppercase;
          margin-top: calc(5pt * var(--fator-escala));
          color: #ff0000; 
      }

      /* NOVO BLOCO: Crie uma regra específica para a descrição */
      .descricao-produto {
          font-size: calc(16pt * var(--fator-escala)); 
          font-weight: 600;
          line-height: 1.2;
          text-transform: uppercase;
          margin-top: calc(5pt * var(--fator-escala));
          color: #000; 
      }
      .peso-produto {
        position: absolute;
        top: calc(25mm * var(--fator-escala)); 
        right: calc(7mm * var(--fator-escala));
        font-size: calc(12pt * var(--fator-escala)); 
        font-weight: 700;
        color: #333;
        z-index: 10;
        transform: rotate(-10deg);
      }
      
      .preco-e-unidade {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-top: calc(8pt * var(--fator-escala)); 
        margin-bottom: calc(5pt * var(--fator-escala));
      }

      .valor-principal {
        font-size: calc(150pt * var(--fator-escala)); 
        color: #ff0000;
        font-weight: 900;
        line-height: 0.95;
        letter-spacing: calc(10pt * var(--fator-escala));
        font-family: 'Bebas Neue', sans-serif;
        display: inline-block;
        text-align: right;
        width: auto;
      }

      .valor-principal .centavos {
        font-size: calc(105pt * var(--fator-escala)); 
        line-height: 0.95;
        letter-spacing: calc(2pt * var(--fator-escala));
        vertical-align: super;
        font-weight: 700;
        margin-left: calc(-8pt * var(--fator-escala));
        font-family: 'Bebas Neue', sans-serif;
        position: relative;
        top: calc(20pt * var(--fator-escala));
      }
      

      .info-adicional {
        font-size: calc(16pt * var(--fator-escala)); 
        color: #333;
        font-weight: 700;
        text-transform: uppercase;
        margin-top: calc(-30pt * var(--fator-escala)); 
        align-self: center;
        margin-right: 0;
        position: absolute;
        
        top: 90%;
        left: 65%;
        transform: translateX(-50%);
      }

      .logo-empresa {
        width: calc(120pt * var(--fator-escala)); 
        height: auto; 

        position: absolute;
        bottom: calc(4mm * var(--fator-escala));
        left: 50%;
        transform: translateX(-50%);
      }

      .logo-empresa svg {
        width: calc(120pt * var(--fator-escala));
        height: auto;
      }

      /* ==================== ESTILOS DE IMPRESSÃO (A4) ==================== */
      @media print {
        .formulario, button, .container-principal h2, .container-etiquetas-impressao h3, .botoes-acao, #preview-etiqueta, hr { 
          display: none;
        }

        body {
          margin: 0;
          padding: 0;
          background-color: white;
        }

        .container-etiquetas-impressao {
          box-shadow: none;
          padding: 0;
          margin: 0;
          width: 100%;
          min-height: auto;
        }

        /* ------------------ CORREÇÃO A4 AQUI ------------------ */
        .etiqueta {
          --fator-escala: 1 !important; 
          border: 1px dashed #ccc;
          margin: 0;
          float: left;
          box-shadow: none;
          
          /* Força a etiqueta a caber dentro das margens de impressão do papel */
          /* Isso garante que a etiqueta de 210mm não seja cortada, pois 98vw é a largura visível */
          max-width: 98vw !important; 
          max-height: 98vh !important;
          width: auto !important; 
          height: auto !important;
        }
        /* ---------------------------------------------------- */
      }
    </style>
  </head>
  <body onload="atualizarPreview()">
    <div class="container-principal">
      <div class="formulario">
        <h2>Adicionar Produto</h2>
        <label for="tamanhoEtiqueta">Tamanho da Etiqueta:</label>
        <select id="tamanhoEtiqueta" onchange="atualizarPreview()">
            <option value="A4">A4 (210mm x 297mm) - Grande</option>
            <option value="A5">A5 (148mm x 210mm) - Médio</option>
            <option value="A6" selected>A6 (105mm x 148mm) - Pequeno (Base)</option>
            <option value="Custom">Customizado (74mm x 105mm)</option>
        </select>
        
        <form id="formEtiqueta" oninput="atualizarPreview()"> 
          <label for="produto">Produto:</label>
          <input type="text" id="produto" placeholder="Ex: Pão de Forma" required>
          <label for="descricao">Descrição:</label>
          <input type="text" id="descricao" placeholder="Ex: Integral 12 Grãos">
          <label for="marca">Marca:</label>
          <input type="text" id="marca" placeholder="Ex: Pullman">
          <label for="precoCheio">Preço (R$):</label>
          <input type="number" id="precoCheio" step="0.01" placeholder="Ex: 5.99" required>
          <label for="unidade">Unidade (CADA, KG, LT...):</label>
          <input type="text" id="unidade" value="CADA" placeholder="Ex: CADA, KG, LT" required>
          <label for="peso">Peso/Volume (Opcional):</label>
          <input type="text" id="peso" placeholder="Ex: 450g ou 1 Litro">
        </form>
        <div class="botoes-acao">
          <button id="btnAddEtiqueta" onclick="adicionarEtiqueta()">Adicionar Etiqueta</button>
        </div>
        <div class="botoes-acao">
          <button id="btnPrint" onclick="window.print()">Imprimir Etiquetas</button>
          <button id="btnLimpar" onclick="limparEtiquetas()">Limpar Lista</button>
        </div>
      </div>
      <div class="container-etiquetas-impressao">
        <h3>Pré-visualização (Tempo Real):</h3>
        <div id="preview-etiqueta" class="etiqueta">
          <p style="text-align: center; font-style: italic; color: #555;">Carregando...</p>
        </div>
        
        <hr>
        
        <h3>Lista de Etiquetas para Impressão:</h3>
        <div id="etiquetas-output">
          <p>Use o formulário ao lado e clique em "Adicionar Etiqueta" para montar sua lista.</p>
        </div>
      </div>
    </div>
    <script>
      /* ==================== LÓGICA JAVASCRIPT ==================== */
      
      const LARGURA_REFERENCIA = 105; // Largura do A6 em mm (usada como 100% de escala)

      const TAMANHOS_ETIQUETA = {
          'A4': { width: '210mm', height: '297mm' },
          'A5': { width: '148mm', height: '210mm' },
          'A6': { width: '105mm', height: '148mm' },
          'Custom': { width: '74mm', height: '105mm' } 
      };

      function getValor(id) {
        return document.getElementById(id).value.trim();
      }

      function formatarPreco(preco) {
        const valor = parseFloat(preco) || 0;
        return valor.toFixed(2).replace('.', ',');
      }

      function gerarLogoSvg() {
        return `
            <svg viewBox="0 0 100 20">
              <rect x="0" y="0" width="100" height="20" rx="10" fill="#66b3ff" />
              <rect x="0" y="0" width="100" height="20" rx="10" fill="url(#grad)" />
              <defs>
                <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#3f7bbf;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#66b3ff;stop-opacity:1" />
                </linearGradient>
              </defs>
              <circle cx="20" cy="10" r="7" fill="white" />
              <text x="20" y="13" font-family="Poppins, sans-serif" font-size="8" text-anchor="middle" fill="#E60000" font-weight="900">G</text>
              <text x="50" y="13" font-family="Poppins, sans-serif" font-size="8" text-anchor="middle" fill="white" font-weight="700">GRUPO</text>
              <text x="80" y="13" font-family="Poppins, sans-serif" font-size="8" text-anchor="middle" fill="white" font-weight="700">MEGA</text>
            </svg>
        `;
      }
      
      function gerarEtiquetaHtml(nomeProduto, descricao, marca, precoCheio, unidade, peso, tamanhoEtiqueta) {
          const precoFormatado = formatarPreco(precoCheio);
          const partesPreco = precoFormatado.split(',');
          const reais = partesPreco[0];
          const centavos = partesPreco[1];
          const dimensoes = TAMANHOS_ETIQUETA[tamanhoEtiqueta] || TAMANHOS_ETIQUETA.Custom;

          const valorPrincipalHtml = `${reais}<span class="centavos">,${centavos}</span>`;

          let infoProdutoHtml = '';
          if (nomeProduto) infoProdutoHtml += `<div class="nome-produto">${nomeProduto.toUpperCase()}</div>`;
          if (descricao) infoProdutoHtml += `<div class="descricao-produto">${descricao.toUpperCase()}</div>`;
          if (marca) infoProdutoHtml += `<div class="marca-produto">${marca.toUpperCase()}</div>`;

          const logoSvg = gerarLogoSvg();
          const pesoHtml = peso ? `<div class="peso-produto">${peso}</div>` : '';
          
          // 1. Definição das dimensões da etiqueta
          const styleAttr = `width: ${dimensoes.width}; height: ${dimensoes.height};`;

          // 2. CÁLCULO DINÂMICO DA ESCALA DE FONTE
          const larguraAtualMM = parseFloat(dimensoes.width.replace('mm', '')); 
          const fatorEscala = (larguraAtualMM / LARGURA_REFERENCIA).toFixed(2); 
          
          const styleVariavel = `--fator-escala: ${fatorEscala};`;


          return `
            <div class="etiqueta" style="${styleAttr} ${styleVariavel}">
                <div class="etiqueta-conteudo">
                    <div class="oferta-tag">OFERTA</div>
                    ${pesoHtml}
                    <div class="info-produto-container">${infoProdutoHtml}</div>
                    <div class="preco-e-unidade">
                      <div class="valor-principal">${valorPrincipalHtml}</div>
                      <div class="info-adicional">${unidade.toUpperCase()}</div>
                    </div>
                </div>
                <div class="logo-empresa">${logoSvg}</div>
            </div>
          `;
      }

      function atualizarPreview() {
        const nomeProduto = getValor('produto');
        const precoCheio = parseFloat(getValor('precoCheio'));
        const tamanhoSelecionado = getValor('tamanhoEtiqueta');
        const previewDiv = document.getElementById('preview-etiqueta');
        
        const dimensoes = TAMANHOS_ETIQUETA[tamanhoSelecionado] || TAMANHOS_ETIQUETA.Custom;
        previewDiv.style.width = dimensoes.width;
        previewDiv.style.height = dimensoes.height;

        if (nomeProduto && !isNaN(precoCheio) && precoCheio > 0) {
          const descricao = getValor('descricao');
          const marca = getValor('marca');
          const unidade = getValor('unidade') || 'CADA';
          const peso = getValor('peso');
          
          const conteudoEtiqueta = gerarEtiquetaHtml(nomeProduto, descricao, marca, precoCheio, unidade, peso, tamanhoSelecionado);
          
          const parser = new DOMParser();
          const doc = parser.parseFromString(conteudoEtiqueta, 'text/html');
          
          const novaEtiqueta = doc.querySelector('.etiqueta');
          
          if (novaEtiqueta) {
            previewDiv.style.cssText = novaEtiqueta.style.cssText;
            previewDiv.innerHTML = novaEtiqueta.innerHTML;
          }

        } else {
          previewDiv.innerHTML = '<p style="text-align: center; font-style: italic; color: #555;">Preencha os campos para ver a etiqueta.</p>';
        }
      }

      function adicionarEtiqueta() {
        const nomeProduto = getValor('produto');
        const precoCheio = parseFloat(getValor('precoCheio'));
        const tamanhoSelecionado = getValor('tamanhoEtiqueta');
        
        if (!nomeProduto || isNaN(precoCheio) || precoCheio <= 0) {
          alert("Por favor, preencha o nome do produto e um preço válido.");
          return;
        }

        const descricao = getValor('descricao');
        const marca = getValor('marca');
        const unidade = getValor('unidade') || 'CADA';
        const peso = getValor('peso');

        const outputDiv = document.getElementById('etiquetas-output');
        
        const mensagemInicial = outputDiv.querySelector('p');
        if (mensagemInicial) outputDiv.removeChild(mensagemInicial);

        const novaEtiquetaHtml = gerarEtiquetaHtml(nomeProduto, descricao, marca, precoCheio, unidade, peso, tamanhoSelecionado);
        outputDiv.innerHTML += novaEtiquetaHtml;

        document.getElementById('formEtiqueta').reset();
        document.getElementById('unidade').value = 'CADA';
        document.getElementById('produto').focus();
        
        atualizarPreview();
      }

      function limparEtiquetas() {
        if (confirm("Tem certeza que deseja limpar a lista de etiquetas?")) {
          document.getElementById('etiquetas-output').innerHTML = '<p>Use o formulário ao lado e clique em "Adicionar Etiqueta" para montar sua lista.</p>';
        }
      }

    </script>
  </body>
</html>
